Not ready for review yet, messy stuff inside :)
###############################################
